var cbpHorizontalMenu = (function() {

	var $listItems = $( '#cbp-hrmenu > ul > li' ),
		$menuItems = $listItems.children( 'a' ),
		$body = $( 'body' ),
		current = -1;

	function init() {
		$menuItems.on( 'click', open );
		$listItems.on( 'click', function( event ) { event.stopPropagation(); });
	}

	function open( event ) {
        if($(event.currentTarget).attr('clickable')) {
            location.href = $(event.currentTarget).attr('href');
        }
        var open_class = 'cbp-hropen';
        if( event.currentTarget.className  == 'dropdown-toggle' ) {
            open_class = 'open'
        }
		if( current !== -1 ) {
			$listItems.eq( current ).removeClass( open_class );
		}

		var $item = $( event.currentTarget ).parent( 'li' ),
			idx = $item.index();

		if( current === idx ) {
			$item.removeClass( open_class );
			current = -1;
		}
		else {
			$item.addClass( open_class );
			current = idx;
			$body.off( 'click' ).on( 'click', close );
		}

		return false;
	}

	function close( event ) {
	    var open_class = 'cbp-hropen';
        if( event.currentTarget.className  == 'dropdown-toggle' ) {
            open_class = 'open'
        }
		$listItems.eq( current ).removeClass( open_class );
		current = -1;
	}

	return { init : init };

})();